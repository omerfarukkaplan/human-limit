<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HUMAN LIMIT</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
<style>
body {
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  text-align:center;
}
button{
  padding:12px 20px;
  margin:10px;
  background:#00ffcc;
  border:none;
  border-radius:8px;
  font-weight:bold;
}
.card{
  background:#1a1a1a;
  padding:20px;
  border-radius:12px;
  margin:20px auto;
  width:400px;
}
#gameArea{
  height:200px;
  background:#222;
  margin-top:20px;
  display:flex;
  align-items:center;
  justify-content:center;
}
</style>
</head>

<body>

<h1>HUMAN LIMIT</h1>

<div id="auth">
  <input id="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="signUp()">Sign Up</button>
  <button onclick="login()">Login</button>
</div>

<div id="app" style="display:none;">
  <h2>Dashboard</h2>
  <button onclick="startReaction()">Reaction Game</button>
  <button onclick="startMemory()">Memory Game</button>
  <button onclick="openPremium()">Go Premium</button>
  <button onclick="loadLeaderboard()">Leaderboard</button>
  <div id="gameArea"></div>
  <div id="result"></div>
</div>

<script>

const supabase = window.supabase.createClient(
  "https://mzvrzlwyvdfibusjfltf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16dnJ6bHd5dmRmaWJ1c2pmbHRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMDYxODksImV4cCI6MjA4Njc4MjE4OX0.Y6c_KVS79tU1TL3ToZj5mfsXo5_UpzFk8rXZicEDFDo"
)

let currentUser=null

async function signUp(){
  const {data,error}=await supabase.auth.signUp({
    email:email.value,
    password:password.value
  })
  if(!error){
    alert("Check email")
  }
}

async function login(){
  const {data,error}=await supabase.auth.signInWithPassword({
    email:email.value,
    password:password.value
  })
  if(!error){
    currentUser=data.user
    auth.style.display="none"
    app.style.display="block"
  }
}

//////////////////////////////
// REACTION GAME
//////////////////////////////

let reactionStart

function startReaction(){
  gameArea.innerHTML="Wait..."
  setTimeout(()=>{
    gameArea.innerHTML="CLICK!"
    reactionStart=Date.now()
    gameArea.onclick=()=>{
      const reaction=Date.now()-reactionStart
      result.innerHTML="Reaction: "+reaction+" ms"
      saveScore(reaction)
      gameArea.onclick=null
    }
  },2000+Math.random()*2000)
}

//////////////////////////////
// MEMORY GAME
//////////////////////////////

function startMemory(){
  gameArea.innerHTML=""
  const numbers=[1,2,3,4].sort(()=>0.5-Math.random())
  numbers.forEach(n=>{
    const btn=document.createElement("button")
    btn.innerText=n
    btn.onclick=()=>memoryClick(n)
    gameArea.appendChild(btn)
  })
}

let memoryStep=1
function memoryClick(n){
  if(n===memoryStep){
    memoryStep++
    if(memoryStep>4){
      result.innerHTML="Memory success"
      saveScore(200)
      memoryStep=1
    }
  }else{
    result.innerHTML="Memory failed"
    memoryStep=1
  }
}

//////////////////////////////
// SAVE SCORE
//////////////////////////////

async function saveScore(score){
  await supabase.from("test_results").insert({
    user_id:currentUser.id,
    reaction_score:score
  })
}

//////////////////////////////
// LEADERBOARD
//////////////////////////////

async function loadLeaderboard(){
  const {data}=await supabase
  .from("leaderboard")
  .select("*")
  .order("iq_score",{ascending:false})
  .limit(10)

  gameArea.innerHTML=""
  data.forEach(row=>{
    const div=document.createElement("div")
    div.innerText=row.iq_score
    gameArea.appendChild(div)
  })
}

//////////////////////////////
// PREMIUM
//////////////////////////////

function openPremium(){
  Paddle.Environment.set("sandbox")
  Paddle.Initialize({token:"test_9d9daacf23a3e1f3ee848f1b8f0"})
  Paddle.Checkout.open({
    items:[{priceId:"pri_01khjtmydh0vjrmgc934n95339",quantity:1}]
  })
}

</script>
</body>
</html>