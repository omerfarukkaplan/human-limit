<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>HUMAN LIMIT</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}
.card{
  background:#1e293b;
  padding:30px;
  border-radius:15px;
  width:400px;
  margin:40px auto;
}
button{
  padding:12px;
  margin:8px;
  border:none;
  border-radius:8px;
  background:#22d3ee;
  cursor:pointer;
  font-weight:bold;
}
.hidden{display:none;}
#reactionBox{
  width:300px;
  height:150px;
  margin:20px auto;
  background:red;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,60px);
  gap:10px;
  justify-content:center;
}
.cell{
  width:60px;
  height:60px;
  background:#334155;
  cursor:pointer;
}
.active{background:#22d3ee;}
</style>
</head>

<body>

<h1>HUMAN LIMIT</h1>

<div class="card" id="authCard">
  <input id="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Login</button>
</div>

<div class="card hidden" id="gameCard">

  <h2>Reaction Game</h2>
  <div id="reactionBox">Wait...</div>
  <button id="startReaction">Start</button>

  <h2>Memory Game</h2>
  <div class="grid" id="grid"></div>

  <h2>Leaderboard</h2>
  <div id="leaderboard"></div>

  <button id="premiumBtn">Go Premium</button>
</div>

<script>
const supabaseUrl = "https://mzvrzlwyvdfibusjfltf.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16dnJ6bHd5dmRmaWJ1c2pmbHRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMDYxODksImV4cCI6MjA4Njc4MjE4OX0.Y6c_KVS79tU1TL3ToZj5mfsXo5_UpzFk8rXZicEDFDo";
const sb = window.supabase.createClient(supabaseUrl, supabaseKey);

// AUTH
const signupBtn = document.getElementById("signupBtn");
const loginBtn = document.getElementById("loginBtn");

signupBtn.addEventListener("click", async ()=>{
  const email = emailInput.value;
  const password = passwordInput.value;

  const { error } = await sb.auth.signUp({email,password});
  if(error) alert(error.message);
  else alert("Signup success");
});

loginBtn.addEventListener("click", async ()=>{
  const email = emailInput.value;
  const password = passwordInput.value;

  const { error } = await sb.auth.signInWithPassword({email,password});
  if(error) alert(error.message);
  else loadApp();
});

async function loadApp(){
  document.getElementById("authCard").classList.add("hidden");
  document.getElementById("gameCard").classList.remove("hidden");
  loadLeaderboard();
}

// REACTION GAME
let startTime;
const reactionBox = document.getElementById("reactionBox");

document.getElementById("startReaction").addEventListener("click", ()=>{
  reactionBox.style.background="red";
  reactionBox.innerText="Wait...";
  setTimeout(()=>{
    reactionBox.style.background="green";
    reactionBox.innerText="CLICK!";
    startTime=Date.now();
  }, Math.random()*3000+1000);
});

reactionBox.addEventListener("click", async ()=>{
  if(reactionBox.style.background==="green"){
    const reaction = Date.now()-startTime;
    alert("Reaction: "+reaction+" ms");

    const { data: userData } = await sb.auth.getUser();
    await sb.from("test_results").insert({
      user_id:userData.user.id,
      reaction_score:reaction,
      memory_score:0,
      risk_score:0,
      focus_score:0
    });
  }
});

// MEMORY GAME
const grid = document.getElementById("grid");
let activeCells=[];

for(let i=0;i<16;i++){
  const cell=document.createElement("div");
  cell.classList.add("cell");
  cell.addEventListener("click", ()=>{
    if(activeCells.includes(i)){
      cell.classList.add("active");
    }
  });
  grid.appendChild(cell);
}

function startMemory(){
  activeCells=[];
  const cells=document.querySelectorAll(".cell");
  cells.forEach(c=>c.classList.remove("active"));
  for(let i=0;i<4;i++){
    const rand=Math.floor(Math.random()*16);
    activeCells.push(rand);
    cells[rand].classList.add("active");
  }
  setTimeout(()=>{
    cells.forEach(c=>c.classList.remove("active"));
  },1000);
}
startMemory();

// LEADERBOARD
async function loadLeaderboard(){
  const { data } = await supabase
    .from("leaderboard")
    .select("*")
    .order("iq_score",{ascending:false})
    .limit(10);

  const div=document.getElementById("leaderboard");
  div.innerHTML="";
  data.forEach(d=>{
    div.innerHTML+=`<p>${d.iq_score}</p>`;
  });
}

// PREMIUM (Paddle)
Paddle.Environment.set("sandbox");
Paddle.Initialize({token:"test_9d9daacf23a3e1f3ee848f1b8f0"});

document.getElementById("premiumBtn").addEventListener("click", ()=>{
  Paddle.Checkout.open({
    items:[{priceId:"pri_01khjtmydh0vjrmgc934n95339",quantity:1}]
  });
});
</script>

</body>
</html>