<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HUMAN LIMIT</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: radial-gradient(circle at top, #0f2027, #203a43, #2c5364);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.container {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(20px);
    padding: 40px;
    border-radius: 20px;
    width: 400px;
    box-shadow: 0 0 40px rgba(0,255,200,0.3);
}
h1 {
    text-align: center;
    letter-spacing: 4px;
}
input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,0.1);
    color: white;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    background: linear-gradient(45deg,#00ffcc,#00ffaa);
    font-weight: bold;
    cursor: pointer;
}
button:hover {
    opacity: 0.9;
}
.profile-box {
    margin-top: 20px;
    padding: 15px;
    border-radius: 10px;
    background: rgba(0,0,0,0.4);
}
.score-box {
    margin-top: 20px;
}
.hidden {
    display: none;
}
</style>
</head>

<body>

<div class="container">
    <h1>HUMAN LIMIT</h1>

    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">

    <button onclick="signUp()">Sign Up</button>
    <button onclick="login()">Login</button>

    <div class="score-box hidden" id="gameArea">
        <button onclick="playGame()">Run Personality Test</button>
    </div>

    <div class="profile-box hidden" id="profileBox"></div>
</div>

<script>

const supabase = window.supabase.createClient(
    "https://mzvrzlwyvdfibusjfltf.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16dnJ6bHd5dmRmaWJ1c2pmbHRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMDYxODksImV4cCI6MjA4Njc4MjE4OX0.Y6c_KVS79tU1TL3ToZj5mfsXo5_UpzFk8rXZicEDFDo"
);

let currentUser = null;

async function signUp() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const { data, error } = await supabase.auth.signUp({
        email,
        password
    });

    if (error) {
        alert(error.message);
        return;
    }

    alert("Signup successful. Now login.");
}

async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
    });

    if (error) {
        alert(error.message);
        return;
    }

    currentUser = data.user;
    document.getElementById("gameArea").classList.remove("hidden");
    loadProfile();
}

async function playGame() {

    if (!currentUser) return;

    const reaction = Math.floor(Math.random() * 100);
    const memory = Math.floor(Math.random() * 100);
    const risk = Math.floor(Math.random() * 100);
    const focus = Math.floor(Math.random() * 100);

    const { error } = await supabase
        .from("test_results")
        .insert([{
            user_id: currentUser.id,
            reaction_score: reaction,
            memory_score: memory,
            risk_score: risk,
            focus_score: focus
        }]);

    if (error) {
        alert(error.message);
        return;
    }

    setTimeout(loadProfile, 1000);
}

async function loadProfile() {

    if (!currentUser) return;

    const { data, error } = await supabase
        .from("personality_profiles")
        .select("*")
        .eq("user_id", currentUser.id)
        .single();

    if (error) return;

    document.getElementById("profileBox").classList.remove("hidden");
    document.getElementById("profileBox").innerHTML = `
        <h3>${data.profile_type}</h3>
        <p>${data.summary}</p>
        <p>Emotional: ${data.emotional_score}</p>
        <p>IQ: ${data.iq_score}</p>
        <p>Dominance: ${data.dominance_score}</p>
    `;
}

</script>
</body>
</html>