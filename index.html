<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HUMAN LIMIT â€” Survivor Mode</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family: 'Segoe UI', sans-serif;
}

body{
background: radial-gradient(circle at top,#111827,#050508);
color:white;
display:flex;
flex-direction:column;
align-items:center;
min-height:100vh;
}

h1{
margin-top:60px;
font-weight:600;
letter-spacing:4px;
opacity:0.8;
}

.main-card{
margin-top:40px;
background:rgba(255,255,255,0.05);
backdrop-filter:blur(20px);
border:1px solid rgba(255,255,255,0.1);
border-radius:20px;
padding:40px;
width:400px;
text-align:center;
box-shadow:0 0 40px rgba(0,255,150,0.1);
}

.ms{
font-size:72px;
margin:30px 0;
font-weight:700;
color:#00ffae;
text-shadow:0 0 20px rgba(0,255,150,0.5);
}

button{
padding:14px 28px;
border:none;
border-radius:10px;
background:linear-gradient(90deg,#00ffae,#00ccff);
color:#000;
font-weight:600;
cursor:pointer;
transition:0.3s;
}

button:hover{
transform:scale(1.05);
box-shadow:0 0 20px rgba(0,255,200,0.5);
}

.status{
margin-top:15px;
font-size:14px;
opacity:0.8;
}

.board{
margin-top:50px;
width:400px;
}

.board h3{
margin-bottom:15px;
opacity:0.7;
}

.player{
padding:10px;
background:rgba(255,255,255,0.05);
margin-bottom:8px;
border-radius:10px;
display:flex;
justify-content:space-between;
}

.footer{
margin-top:auto;
margin-bottom:30px;
opacity:0.4;
font-size:12px;
}
</style>
</head>

<body>

<h1>HUMAN LIMIT</h1>

<div class="main-card">
<div id="status" class="status">Ready</div>
<div class="ms" id="reaction">TAP TO BEGIN</div>
<button onclick="startGame()">START</button>
</div>

<div class="board">
<h3>ðŸ”¥ Global Survivors</h3>
<div id="leaderboard"></div>
</div>

<div class="footer">
Only the fastest survive.
</div>

<script>
(function(){

// =====================
// CONFIG
// =====================

const SUPABASE_URL = "https://lyyejixcijtidovuteff.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5eWVqaXhjaWp0aWRvdnV0ZWZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNDI5OTAsImV4cCI6MjA4NjcxODk5MH0.U1YcPK7FGTnv-1eaDo5eqvw0wq4cnG_69y0KqQJURjQ";

const sbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let startTime = 0;
let playedToday = false;
let seasonId = null;
let nickname = localStorage.getItem("nickname");

// =====================
// INIT
// =====================

async function init(){

if(!nickname){
nickname = prompt("Nickname:");
localStorage.setItem("nickname",nickname);
}

await loadSeason();
await checkDaily();
await loadBoard();
}

async function loadSeason(){
const {data} = await sbClient
.from("seasons")
.select("*")
.eq("is_active",true)
.limit(1)
.single();

if(data) seasonId = data.id;
}

async function checkDaily(){
const today = new Date().toISOString().split("T")[0];

const {data} = await sbClient
.from("daily_scores")
.select("*")
.eq("nickname",nickname)
.eq("season_id",seasonId)
.gte("created_at",today);

if(data && data.length > 0){
playedToday = true;
document.getElementById("status").innerText="Eliminated today.";
}
}

window.startGame = function(){

if(playedToday){
alert("BugÃ¼n oynadÄ±n.");
return;
}

document.getElementById("reaction").innerText="WAIT...";
startTime = Date.now();

setTimeout(()=>{
document.body.onclick = registerClick;
},Math.random()*2000+1000);
}

async function registerClick(){

document.body.onclick=null;

const reaction = Date.now()-startTime;

document.getElementById("reaction").innerText = reaction+" ms";
document.getElementById("status").innerText="Eliminated.";

await sbClient.from("scores").insert({
nickname:nickname,
reaction:reaction,
season_id:seasonId,
client_hash:btoa(navigator.userAgent+Date.now())
});

await sbClient.from("daily_scores").insert({
nickname:nickname,
reaction:reaction,
season_id:seasonId,
client_hash:btoa(navigator.userAgent+Date.now())
});

playedToday=true;
loadBoard();
}

async function loadBoard(){

const {data} = await sbClient
.from("scores")
.select("*")
.eq("season_id",seasonId)
.order("reaction",{ascending:true})
.limit(10);

const board=document.getElementById("leaderboard");
board.innerHTML="";

if(!data) return;

data.forEach((row,i)=>{
const div=document.createElement("div");
div.className="player";
div.innerHTML="<span>"+(i+1)+". "+row.nickname+"</span><span>"+row.reaction+" ms</span>";
board.appendChild(div);
});
}

init();

})();
</script>

</body>
</html>