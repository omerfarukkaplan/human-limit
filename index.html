<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HUMAN LIMIT</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>

<style>
body{
  margin:0;
  font-family:Inter,Arial;
  background:linear-gradient(135deg,#0f172a,#020617);
  color:white;
  text-align:center;
}
.container{max-width:1200px;margin:auto;padding:20px;}
.card{
  background:#111827;
  padding:25px;
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 0 40px rgba(0,255,255,0.08);
}
button{
  padding:10px 15px;
  border:none;
  border-radius:8px;
  background:#22d3ee;
  font-weight:bold;
  cursor:pointer;
  margin:5px;
}
.hidden{display:none;}
.grid{
  display:grid;
  grid-template-columns:repeat(4,80px);
  gap:10px;
  justify-content:center;
}
.cell{
  width:80px;height:80px;background:#1f2937;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;cursor:pointer;
}
canvas{margin-top:20px;}
</style>
</head>

<body>
<div class="container">

<h1>HUMAN LIMIT</h1>

<div class="card" id="authCard">
  <input id="emailInput" placeholder="Email"><br><br>
  <input id="passwordInput" type="password" placeholder="Password"><br><br>
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Login</button>
</div>

<div class="card hidden" id="dashboard">

<h2>Games</h2>
<div id="gameButtons"></div>
<div id="gameArea"></div>

<h2>Leaderboard</h2>
<div id="leaderboard"></div>

<h2>Premium</h2>
<button id="premiumBtn">Upgrade</button>

</div>

</div>

<script>

// ================= SAFE SUPABASE =================
let supabase;
if (!window.__SUPABASE__) {
  window.__SUPABASE__ = window.supabase.createClient(
    "https://mzvrzlwyvdfibusjfltf.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16dnJ6bHd5dmRmaWJ1c2pmbHRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMDYxODksImV4cCI6MjA4Njc4MjE4OX0.Y6c_KVS79tU1TL3ToZj5mfsXo5_UpzFk8rXZicEDFDo"
  );
}
supabase = window.__SUPABASE__;

// ================= PADDLE =================
Paddle.Environment.set("sandbox");
Paddle.Initialize({token:"test_9d9daacf23a3e1f3ee848f1b8f0"});

// ================= AUTH =================
const emailInput=document.getElementById("emailInput");
const passwordInput=document.getElementById("passwordInput");

document.getElementById("signupBtn").onclick=async()=>{
  await supabase.auth.signUp({
    email:emailInput.value,
    password:passwordInput.value
  });
  alert("Check email.");
};

document.getElementById("loginBtn").onclick=async()=>{
  const {error}=await supabase.auth.signInWithPassword({
    email:emailInput.value,
    password:passwordInput.value
  });
  if(!error) initApp();
};

async function initApp(){
  document.getElementById("authCard").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
  renderGames();
  loadLeaderboard();
}

// ================= SAVE SCORE =================
async function saveScore(type,score){
  const {data:user}=await supabase.auth.getUser();
  await supabase.from("game_sessions").insert({
    user_id:user.user.id,
    game_type:type,
    score:score,
    raw_data:{}
  });
}

// ================= GAMES =================
const games={};

// 1 Reaction
games["Reaction Test"]={
start:function(){
  const area=document.getElementById("gameArea");
  area.innerHTML="<div id='box' style='width:300px;height:150px;background:red;margin:auto;display:flex;align-items:center;justify-content:center;'>Wait</div>";
  const box=document.getElementById("box");
  let start;
  setTimeout(()=>{
    box.style.background="green";
    box.innerText="CLICK!";
    start=performance.now();
  },Math.random()*2000+1000);

  box.onclick=()=>{
    const reaction=Math.floor(performance.now()-start);
    saveScore("reaction",reaction);
    alert("Reaction: "+reaction+"ms");
  };
}};

// 2 Memory Numbers
games["Memory Numbers"]={
start:function(){
  const area=document.getElementById("gameArea");
  const num=Math.floor(Math.random()*9000+1000);
  area.innerHTML=`<h3>Memorize: ${num}</h3>`;
  setTimeout(()=>{
    area.innerHTML="<input id='ans'><button id='check'>Check</button>";
    document.getElementById("check").onclick=()=>{
      const val=document.getElementById("ans").value;
      const score=val==num?100:0;
      saveScore("memory",score);
      alert("Score: "+score);
    };
  },2000);
}};

// 3 Click Speed
games["Click Speed"]={
start:function(){
  const area=document.getElementById("gameArea");
  area.innerHTML="<button id='clicker'>Click Fast</button><p id='count'>0</p>";
  let count=0;
  const btn=document.getElementById("clicker");
  btn.onclick=()=>count++;
  setTimeout(()=>{
    saveScore("speed",count);
    alert("Clicks: "+count);
  },5000);
}};

// 4 Math Blitz
games["Math Blitz"]={
start:function(){
  const a=Math.floor(Math.random()*10);
  const b=Math.floor(Math.random()*10);
  const area=document.getElementById("gameArea");
  area.innerHTML=`<h3>${a}+${b}</h3><input id='ans'><button id='ok'>OK</button>`;
  document.getElementById("ok").onclick=()=>{
    const score=document.getElementById("ans").value==(a+b)?100:0;
    saveScore("math",score);
    alert("Score:"+score);
  };
}};

// 5 Color Reflex
games["Color Reflex"]={
start:function(){
  const area=document.getElementById("gameArea");
  const colors=["red","blue","green","yellow"];
  const c=colors[Math.floor(Math.random()*4)];
  area.innerHTML=`<h3>Click ${c}</h3>`;
  colors.forEach(col=>{
    const b=document.createElement("button");
    b.style.background=col;
    b.innerText=col;
    b.onclick=()=>{
      const score=col===c?100:0;
      saveScore("color",score);
      alert("Score:"+score);
    };
    area.appendChild(b);
  });
}};

// 6 Pattern Match
games["Pattern Match"]={
start:function(){
  const area=document.getElementById("gameArea");
  area.innerHTML="<div class='grid' id='grid'></div>";
  const grid=document.getElementById("grid");
  let active=[];
  for(let i=0;i<16;i++){
    const cell=document.createElement("div");
    cell.className="cell";
    grid.appendChild(cell);
  }
  const cells=document.querySelectorAll(".cell");
  for(let i=0;i<3;i++){
    let r=Math.floor(Math.random()*16);
    active.push(r);
    cells[r].style.background="#22d3ee";
  }
  setTimeout(()=>cells.forEach(c=>c.style.background="#1f2937"),1000);
  let score=0;
  cells.forEach((c,i)=>{
    c.onclick=()=>{
      if(active.includes(i))score++;
      if(score===3){
        saveScore("pattern",100);
        alert("Success");
      }
    };
  });
}};

// 7â€“10 Logic Mini
for(let i=7;i<=10;i++){
  games["Logic "+i]={
    start:function(){
      const area=document.getElementById("gameArea");
      const n=Math.floor(Math.random()*100);
      area.innerHTML=`<h3>Is ${n} even?</h3>
      <button id='yes'>Yes</button>
      <button id='no'>No</button>`;
      document.getElementById("yes").onclick=()=>check(true);
      document.getElementById("no").onclick=()=>check(false);
      function check(ans){
        const correct=(n%2===0);
        const score=(ans===correct)?100:0;
        saveScore("logic",score);
        alert("Score:"+score);
      }
    }
  };
}

// ================= RENDER =================
function renderGames(){
  const container=document.getElementById("gameButtons");
  container.innerHTML="";
  Object.keys(games).forEach(k=>{
    const b=document.createElement("button");
    b.innerText=k;
    b.onclick=()=>games[k].start();
    container.appendChild(b);
  });
}

// ================= LEADERBOARD =================
async function loadLeaderboard(){
  const {data}=await supabase
    .from("leaderboard")
    .select("*")
    .order("iq_score",{ascending:false})
    .limit(10);
  const div=document.getElementById("leaderboard");
  div.innerHTML="";
  if(data) data.forEach(d=>{
    div.innerHTML+=`<p>${d.iq_score}</p>`;
  });
}

// ================= PREMIUM =================
document.getElementById("premiumBtn").onclick=()=>{
  Paddle.Checkout.open({
    items:[{priceId:"pri_01khjtmydh0vjrmgc934n95339",quantity:1}]
  });
};

</script>

</body>
</html>